#cloud-config
package_update: true

package_upgrade: true

packages:
  - aptitude
  - curl
  - git
  - python
  - python-pip
  - software-properties-common

runcmd:
  - git clone --recursive "https://github.com/jacobfgrant/lotus.git" /root/lotus
  - chmod 0744 /root/lotus/bootstrap.sh
  - mkdir /var/log/lotus

write_files:
  - path: /etc/cron.d/cron_bootstrap
    owner: root:root
    permissions: 644
    content:  |
      PATH=/usr/bin:/bin:/usr/sbin:/sbin
      @reboot root /root/lotus/bootstrap.sh >> /var/log/lotus/bootstrap.log 2>&1
    
  - path: /root/bootstrap_variables
    owner: root:root
    permissions: 400
    content: insert_bootstrap_variables
    # Content is dynamically generated by user script

power_state:
  timeout: 10
  mode: reboot
