#cloud-config
package_update: true

package_upgrade: true

packages:
  - aptitude
  - curl
  - git
  - python
  - python-pip
  - software-properties-common
  - unzip

runcmd:
  - wget -O /root/lotus-version-0.1.zip https://github.com/jacobfgrant/lotus/archive/version-0.1.zip
  - unzip /root/lotus-version-0.1.zip -d /root/
  - mv /root/lotus-version-0.1 /root/lotus
  - chmod 0744 /root/lotus/bootstrap.sh
  - mkdir /var/log/lotus
  - echo "PATH=/usr/bin:/bin:/usr/sbin:/sbin" >> /etc/cron.d/cron_bootstrap
  - echo "@reboot root /root/lotus/bootstrap.sh >> /var/log/lotus/bootstrap.log 2>&1" >> /etc/cron.d/cron_bootstrap
  - chmod 0644 /etc/cron.d/cron_bootstrap

write_files:
  - path: /root/bootstrap_variables
    owner: root:root
    permissions: 400
    content:  |
      insert_bootstrap_variables
    # Content is dynamically generated by user script

power_state:
  timeout: 30
  mode: reboot
